{% extends 'base.html' %}

{% block title %}Courses | EduVanta{% endblock %}

{% block extra_css %}
<style>
    /* Course Card Hover Animation */
    .course-card {
        transition: all 0.3s ease;
        transform: translateY(0);
    }
    
    .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(99, 102, 241, 0.1);
    }
    
    /* Filter Chip Animation */
    .filter-chip {
        transition: all 0.2s ease;
    }
    
    .filter-chip:hover {
        transform: scale(1.05);
    }
    
    .filter-chip.active {
        background: linear-gradient(to right, #6366F1, #06B6D4);
        color: white;
        box-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
    }
    
    /* XP Badge Animation */
    .xp-badge {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.4);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(250, 204, 21, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(250, 204, 21, 0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Hero Banner -->
    <div class="bg-gradient-to-r from-indigo-600 to-cyan-500 rounded-xl p-8 mb-8 text-white">
        <div class="flex items-start justify-between gap-4">
            <div class="max-w-4xl">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Discover Your Next Learning Adventure</h1>
            <p class="text-lg mb-6 opacity-90">Explore our wide range of courses designed to help you master new skills, advance your career, and achieve your learning goals.</p>
            <div class="flex items-center space-x-2">
                <div class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg">
                    <span class="text-sm font-medium">{{ total_courses }} Courses Available</span>
                </div>
                <div class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg">
                    <span class="text-sm font-medium">{{ total_instructors }} Expert Instructors</span>
                </div>
            </div>
            </div>
            {% if user.is_authenticated %}
              {% if user.is_staff or user.role == 'teacher' or user.role == 'admin' %}
              <div class="shrink-0">
                  <a href="{% url 'courses:wizard_start' %}"
                     class="inline-flex items-center gap-2 bg-white text-indigo-700 hover:bg-indigo-50 font-semibold px-4 py-2 rounded-lg shadow"
                     title="Create a new course">
                     <i class="fas fa-plus-circle"></i>
                     Create Course
                  </a>
              </div>
              {% endif %}
            {% endif %}
        </div>
    </div>
    
    <!-- Search and Filters -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <!-- Search Bar -->
            <div class="relative w-full md:w-96">
                <input type="text" id="search" value="{{ search_term }}" placeholder="Search courses..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
            
            <!-- Sort Options -->
            <div class="flex items-center space-x-2 w-full md:w-auto">
                <span class="text-sm text-gray-600">Sort by:</span>
                <select id="sort" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                    <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest</option>
                </select>
            </div>
        </div>
        
        <!-- Real Filters: Department & Specialization -->
        <div class="flex flex-col sm:flex-row gap-4">
            <div class="w-full sm:w-64">
                <label class="block text-sm text-gray-600 mb-1">Department</label>
                <select id="department" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                    <option value="">All Departments</option>
                    {% for d in departments %}
                    <option value="{{ d.id }}" {% if active_department|stringformat:'s' == d.id|stringformat:'s' %}selected{% endif %}>{{ d.code }} - {{ d.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="w-full sm:w-64">
                <label class="block text-sm text-gray-600 mb-1">Specialization</label>
                <select id="specialization" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                    <option value="">All Specializations</option>
                    {% for s in specializations %}
                    <option value="{{ s.id }}" {% if active_specialization|stringformat:'s' == s.id|stringformat:'s' %}selected{% endif %}>{{ s.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <!-- Course Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for course in courses %}
        <!-- Course Card -->
        <div class="course-card bg-white rounded-xl overflow-hidden shadow-lg border border-gray-100">
            <!-- Course Image -->
            <div class="relative">
                {% if course.thumbnail %}
                <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" class="w-full h-48 object-cover">
                {% else %}
                <div class="w-full h-48 bg-gradient-to-r from-indigo-500 to-cyan-500"></div>
                {% endif %}
                <!-- Removed fake XP/Featured badges -->
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                    <div class="flex items-center">
                        <span class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full">{{ course.department.code }}</span>
                        <span class="ml-2 bg-cyan-100 text-cyan-800 text-xs px-2 py-1 rounded-full">{{ course.specialization.name }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Course Content -->
            <div class="p-5">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ course.title }}</h3>
                <p class="text-sm text-gray-600 mb-4 line-clamp-2">{{ course.description|truncatewords:20 }}</p>
                
                <!-- Course Meta -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        {% if course.instructor and course.instructor.profile_picture %}
                        <img src="{{ course.instructor.profile_picture.url }}" alt="{{ course.instructor.get_full_name|default:course.instructor.username }}" class="w-8 h-8 rounded-full mr-2">
                        {% else %}
                        <div class="w-8 h-8 rounded-full bg-gray-200 mr-2 flex items-center justify-center text-gray-500">
                            <i class="fas fa-user"></i>
                        </div>
                        {% endif %}
                        {% if course.instructor %}
                        <span class="text-xs text-gray-700">{{ course.instructor.get_full_name|default:course.instructor.username }}</span>
                        {% else %}
                        <span class="text-xs text-gray-500">TBA</span>
                        {% endif %}
                    </div>
                    <!-- Removed fake rating block -->
                </div>
                
                <!-- Course Stats -->
                <div class="grid grid-cols-3 gap-2 mb-4 text-center text-xs">
                    <div class="bg-gray-50 rounded-lg p-2">
                        <p class="text-gray-500">Students</p>
                        <p class="font-semibold text-gray-800">{{ course.students_count }}</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-2">
                        <p class="text-gray-500">Created</p>
                        <p class="font-semibold text-gray-800">{{ course.created_at|date:"M d, Y" }}</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-2">
                        <p class="text-gray-500">Status</p>
                        <p class="font-semibold text-gray-800">{% if course.published %}Published{% else %}Draft{% endif %}</p>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="flex items-center justify-between mb-4"></div>
                
                <!-- Action Button -->
                <a href="{% url 'courses:course_detail' course.id %}" class="block w-full bg-gradient-to-r from-indigo-600 to-indigo-500 hover:from-indigo-700 hover:to-indigo-600 text-white text-center py-2 rounded-lg transition-all duration-300 transform hover:scale-[1.02] font-medium">
                    View Course
                </a>
            </div>
        </div>
        {% empty %}
        <div class="col-span-1 md:col-span-2 lg:col-span-3">
            <div class="text-center py-12 bg-white rounded-xl shadow border border-gray-100">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2v-7H3v7a2 2 0 002 2z" />
                </svg>
                <h3 class="mt-3 text-lg font-semibold text-gray-900">No courses available</h3>
                <p class="mt-1 text-sm text-gray-500">Courses will appear here when instructors publish them.</p>
                {% if user.is_authenticated %}
                  {% if user.is_staff or user.role == 'teacher' or user.role == 'admin' %}
                  <div class="mt-6">
                      <a href="{% url 'courses:wizard_start' %}"
                         class="inline-flex items-center px-5 py-2.5 rounded-md text-white bg-indigo-600 hover:bg-indigo-700 shadow">
                          <i class="fas fa-plus-circle mr-2"></i>
                          Create your first course
                      </a>
                  </div>
                  {% endif %}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="mt-10 flex justify-center">
        <nav class="inline-flex rounded-md shadow">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="px-4 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-500 hover:bg-gray-50 rounded-l-md">
                Previous
            </a>
            {% else %}
            <span class="px-4 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-300 rounded-l-md cursor-not-allowed">
                Previous
            </span>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="px-4 py-2 bg-white border-t border-b border-gray-300 text-sm font-medium text-indigo-600 bg-indigo-50">
                {{ num }}
            </span>
            {% else %}
            <a href="?page={{ num }}" class="px-4 py-2 bg-white border-t border-b border-gray-300 text-sm font-medium text-gray-500 hover:bg-gray-50">
                {{ num }}
            </a>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="px-4 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-500 hover:bg-gray-50 rounded-r-md">
                Next
            </a>
            {% else %}
            <span class="px-4 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-300 rounded-r-md cursor-not-allowed">
                Next
            </span>
            {% endif %}
        </nav>
    </div>
    {% endif %}
    
    <!-- AI Recommendations -->
    <div class="mt-12 bg-gradient-to-r from-indigo-50 to-cyan-50 rounded-xl p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">Recommended For You</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Recommendation 1 -->
            <div class="bg-white rounded-lg shadow p-4 flex items-start">
                <div class="flex-shrink-0 mr-4">
                    <div class="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-gray-900">Machine Learning Basics</h3>
                    <p class="text-xs text-gray-600 mb-2">Based on your interest in Data Science</p>
                    <a href="#" class="text-xs text-indigo-600 font-medium hover:text-indigo-800">View Course →</a>
                </div>
            </div>
            
            <!-- Recommendation 2 -->
            <div class="bg-white rounded-lg shadow p-4 flex items-start">
                <div class="flex-shrink-0 mr-4">
                    <div class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"></path>
                        </svg>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-gray-900">Web Development with React</h3>
                    <p class="text-xs text-gray-600 mb-2">Students like you also enrolled in this</p>
                    <a href="#" class="text-xs text-indigo-600 font-medium hover:text-indigo-800">View Course →</a>
                </div>
            </div>
            
            <!-- Recommendation 3 -->
            <div class="bg-white rounded-lg shadow p-4 flex items-start">
                <div class="flex-shrink-0 mr-4">
                    <div class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-gray-900">Cybersecurity Fundamentals</h3>
                    <p class="text-xs text-gray-600 mb-2">Trending in your department</p>
                    <a href="#" class="text-xs text-indigo-600 font-medium hover:text-indigo-800">View Course →</a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const navWith = (params) => {
    const url = new URL(window.location.href);
    Object.entries(params).forEach(([k,v]) => {
      if (v === null || v === '' || v === undefined) url.searchParams.delete(k);
      else url.searchParams.set(k, v);
    });
    window.location.href = url.toString();
  };
  const debounce = (fn, d=350) => { let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(null,a), d); }; };

  const search = document.getElementById('search');
  if (search) search.addEventListener('input', debounce(()=> navWith({search: search.value || null})));

  const sort = document.getElementById('sort');
  if (sort) sort.addEventListener('change', ()=> navWith({sort: sort.value || null}));

  const department = document.getElementById('department');
  if (department) department.addEventListener('change', ()=> navWith({department: department.value || null}));

  const specialization = document.getElementById('specialization');
  if (specialization) specialization.addEventListener('change', ()=> navWith({specialization: specialization.value || null}));
});
</script>
{% endblock %}